<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Papaya HUANG</title>
  <!-- add alifont -->

  <link
    rel="stylesheet"
    type="text/css"
    href="https://at.alicdn.com/t/c/font_2719161_qrg05vxlp7.css"
  />
  <!-- add style -->
  
<link rel="stylesheet" href="/css/style.css">

  <!-- add font-->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100&display=swap"
    rel="stylesheet"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap"
    rel="stylesheet"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;300;400;500;600&display=swap"
    rel="stylesheet"
  />
<meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


  <body>
    <header>
  <ul class="navbar">
    <li>
      <a href="/">
        <i class="icon iconfont icon-xuanzhongshangcheng"></i>
      </a>
    </li>
    <li>
      <a href="/about">
        <i class="icon iconfont icon-about"></i>
      </a>
    </li>
    <li>
      <a href="/projects">
        <i class="icon iconfont icon-project"></i>
      </a>
    </li>
    <li>
      <a href="/categories">
        <i class="icon iconfont icon-case-file-full"></i>
      </a>
    </li>
    <li>
      <a href="/archives">
        <i class="icon iconfont icon-Artboard2"></i>
      </a>
    </li>
  </ul>
</header>

    <aside>
  <div class="menu">
    

    <a class="menu-item" href="/">Home</a>

    

    <a class="menu-item" href="/about">About</a>

    

    <a class="menu-item" href="/projects">Projects</a>

    

    <a class="menu-item" href="/categories">Categories</a>

    

    <a class="menu-item" href="/archives">Archives</a>

    
  
  </div>
</aside>


    <div class="main"><div class="blog-post">
  
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6%E7%9A%84%E6%B8%B2%E6%9F%93%E8%A1%8C%E4%B8%BA"><span class="toc-text">å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“è¡Œä¸º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%92%8C%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-text">å‡½æ•°å¼ç»„ä»¶æ¸²æŸ“å’Œå‰¯ä½œç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6%E7%9A%84%E6%B8%B2%E6%9F%93%E9%80%BB%E8%BE%91"><span class="toc-text">å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%95%B0%E7%BB%84%E9%81%BF%E5%85%8D%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E6%B8%B2%E6%9F%93"><span class="toc-text">ä½¿ç”¨ä¾èµ–æ•°ç»„é¿å…ä¸å¿…è¦çš„æ¸²æŸ“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E4%BE%9D%E8%B5%96%E6%95%B0%E7%BB%84%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">å‡å°‘ä¾èµ–æ•°ç»„çš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
  <div class='blog-main'>

    <!-- title -->
    <h2 class="blog-post-title">
      <a href="/2022/10/22/useeffectå¤§å…¨/">
        ç†è§£useEffect
      </a>
    </h2>
  
    <!-- date and author -->
    <p class="blog-post-meta">
      2022-10-22 
    </p>
  
  
    <!-- content -->
    <div class="post-content">
      <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘è‡ªå·±å­¦ä¹  react æ˜¯ç›´æ¥ä»å‡½æ•°å¼ç»„ä»¶å¼€å§‹çš„ï¼Œæ‰€ä»¥åœ¨å­¦ä¹‹å‰å¹¶æ²¡æœ‰ç±»ç»„ä»¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç­‰æ€ç»´çš„å½±å“ã€‚ä½†æ˜¯ç”±äºå¯¹çº¯å‡½æ•°ä»¥åŠå‰¯ä½œç”¨ç­‰æ¦‚å¿µä¹Ÿä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨<code>useEffect</code>çš„æ—¶å€™è¿˜æ˜¯ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œå¹¶ä¸”æ²¡åŠæ³•åˆ¤æ–­å‡ºç°é—®é¢˜çš„æ ¹æºï¼Œæ‰€ä»¥æƒ³é€šè¿‡è¿™ç¯‡æ–‡ç« æ¢³ç†ä¸€ä¸‹æˆ‘è‡ªå·±å­¦ä¹ <code>useEffect</code>çš„ä¸€äº›æ€»ç»“ã€‚</p>
<h2 id="å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“è¡Œä¸º"><a href="#å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“è¡Œä¸º" class="headerlink" title="å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“è¡Œä¸º"></a>å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“è¡Œä¸º</h2><p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªç»„ä»¶ï¼š</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
      Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span><span class="token operator">></span>
      Show alert
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‡è®¾ä½ å…ˆç‚¹å‡»<code>Click me</code>ä¸‰ä¸‹ï¼Œç„¶åç‚¹ä¸€ä¸‹<code>Show alert</code>,ç„¶ååœ¨å›è°ƒå‡½æ•°<code>setTimeout</code>è§¦å‘ä¹‹å‰ï¼Œå†ç‚¹å‡»ä¸¤ä¸‹<code>Click me</code>ã€‚<br>å¼¹å‡ºçš„å¯¹è¯æ¡†æ˜¯ 3 è¿˜æ˜¯ 5 å‘¢ã€‚</p>
<p>æœ€ç»ˆç­”æ¡ˆæ˜¯ 3ï¼Œè€Œä¸æ˜¯ 5ã€‚</p>
<p>åœ¨è§£é‡Šä¸ºä»€ä¹ˆä¼šç”Ÿæˆè¿™ä¸ªç»“æœä¹‹å‰ï¼Œå¯ä»¥çœ‹ä¸€ä¸ª vanilla JS çš„ä¾‹å­ï¼š</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> someone <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'William'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Billy'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

some <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Patrick'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¼¹å‡ºçš„å¯¹è¯æ¡†ä¼šæ¯ä¸ªä¸‰ç§’ï¼Œåˆ†åˆ«æŒ‰é¡ºåºå¼¹å‡º<code>Hello, William</code>, <code>Hello, Billy</code>,<code>Hello, Patrick</code>ã€‚å› ä¸ºæ¯æ¬¡è°ƒç”¨ sayHiï¼Œéƒ½æ˜¯è°ƒç”¨ä¼ å…¥çš„ä¸åŒ<code>someone</code>å®å‚çš„<code>name</code>å±æ€§çš„å€¼ï¼Œå³ä¾¿è¿™ä¸ªè°ƒç”¨è¦åœ¨ 3 ç§’ä¹‹åæ‰§è¡Œï¼Œç»‘å®šçš„å€¼åœ¨ 3 ç§’ä¹‹åä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥ç”Ÿæˆäº†ä¸‰ä¸ªä¸åŒçš„åå­—ã€‚</p>
<p>é‚£ä¹ˆç±»æ¯”æˆ‘ä»¬ä¸Šé¢ React ç»„ä»¶çš„ä¾‹å­ï¼Œ<code>count</code>å€¼æ˜¯ä¸€ä¸ªåœ¨æ¯ä¸€æ¬¡è°ƒç”¨ç»„ä»¶å‡½æ•°çš„æ—¶å€™éƒ½æ˜¯ä¸€ä¸ªæ’å®šçš„å¸¸é‡ï¼ˆconstantï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ç»„ä»¶çš„æ¯ä¸€æ¬¡æ¸²æŸ“ï¼Œéƒ½ç›¸å½“äºè°ƒç”¨äº†ä¸€æ¬¡è¿™ä¸ªç»„ä»¶å‡½æ•°ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨å°±ä¼šæ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„<code>count</code>çš„å€¼ï¼ˆstateï¼‰ã€‚æ‰€ä»¥æ¯æ¬¡å½“æˆ‘ä»¬ç‚¹å‡»ä¸‰æ¬¡<code>Click me</code>æ—¶ï¼Œå½“æ—¶çš„<code>count</code>å€¼ä¸º<code>3</code>, è€Œåœ¨æˆ‘ä»¬ç‚¹å‡»<code>Show alert</code>æ—¶ï¼Œä¼ å…¥å›è°ƒå‡½æ•°çš„<code>count</code>å€¼ä¸º<code>3</code>, ä¹‹åç‚¹å‡»çš„<code>Click me</code>å±äºå¦å¤–ä¸¤æ¬¡æ¸²æŸ“ï¼Œåˆ†åˆ«ç”Ÿæˆäº†å¦å¤–ä¸¤æ¬¡<code>count</code>å€¼ï¼Œäºæˆ‘ä»¬è®°å½•çš„è¿™æ¬¡æ— å…³ï¼Œæ‰€ä»¥æœ€åç»“æœæ˜¯<code>3</code>ä¸æ˜¯<code>5</code>ã€‚</p>
<p>ç”±è¿™ä¸ªä¾‹å­å¯ä»¥å¾—å‡ºï¼š <strong>åœ¨æ¯æ¬¡æ¸²æŸ“ä¸­ï¼Œ<code>props</code>å’Œ<code>state</code>ä¿æŒä¸å˜</strong>ã€‚ï¼ˆğŸ’¡ï¼šè¿™æ˜¯ä¸æ˜¯å’Œçº¯å‡½æ•°ç›¸å…³äº†ï¼ï¼‰</p>
<h2 id="å‡½æ•°å¼ç»„ä»¶æ¸²æŸ“å’Œå‰¯ä½œç”¨"><a href="#å‡½æ•°å¼ç»„ä»¶æ¸²æŸ“å’Œå‰¯ä½œç”¨" class="headerlink" title="å‡½æ•°å¼ç»„ä»¶æ¸²æŸ“å’Œå‰¯ä½œç”¨"></a>å‡½æ•°å¼ç»„ä»¶æ¸²æŸ“å’Œå‰¯ä½œç”¨</h2><p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼Œå¢åŠ ä¸€ä¸ª<code>useEffect</code>:</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>Click me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™é‡Œæ·»åŠ çš„å‰¯ä½œç”¨å°±æ˜¯ï¼Œæ”¹å˜ç½‘é¡µçš„æ ‡é¢˜ï¼Œå¹¶ç”¨<code>useEffect</code>æ¥å®ç°ã€‚<br>é‚£ä¹ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>useEffect</code>æ˜¯å¦‚ä½•è·å–<code>count</code>çš„å€¼çš„å‘¢ï¼Ÿ</p>
<ul>
<li>Reactï¼š å‘ˆç°ä¸€ä¸ª state å€¼ä¸º<code>0</code>çš„ UI</li>
<li>å‡½æ•°ç»„ä»¶ï¼š<ul>
<li>æ¸²æŸ“ç»“æœæ˜¯`<p>You clicked 0 times</p>;</li>
<li>è®°å¾—æ¸²æŸ“å®Œæ¯•åè¦æ‰§è¡Œï¼š <code>()=&gt;&#123;document.title = &#39;You clicked 0 times&#39;&#125;</code></li>
</ul>
</li>
<li>Reactï¼š å¥½ï¼Œæ›´æ–° UIï¼Œå‘ DOM æ·»åŠ æ–°çš„å†…å®¹</li>
<li>æµè§ˆå™¨ï¼š æ¸²æŸ“ï¼</li>
<li>Reactï¼š æ‰§è¡Œå‰¯ä½œç”¨ï¼šæ‰§è¡Œ <code>()=&gt;&#123;document.title = &#39;You clicked 0 times&#39;&#125;</code></li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç»„ä»¶æ¸²æŸ“çš„é€»è¾‘ä¹Ÿæ²¿ç”¨åˆ°å‰¯ä½œç”¨ä¸Šï¼Œæ¯ä¸€æ¬¡ç»„ä»¶çš„æ¸²æŸ“éƒ½ä¼šæœ‰è‡ªå·±çš„ä¸€ä¸ªå‰¯ä½œç”¨ã€‚</p>
<p>æ€»ç»“ï¼š <strong>æ¯ä¸€æ¬¡ç»„ä»¶æ¸²æŸ“ä¸­çš„æ‰€æœ‰å‡½æ•°ï¼ˆäº‹ä»¶å¤„ç†å™¨ã€å‰¯ä½œç”¨ã€å®šæ—¶å™¨æˆ–è€… API è°ƒç”¨ç­‰ï¼‰éƒ½æ•è·è°ƒç”¨æ—¶å®šä¹‰çš„ props å’Œ stateã€‚</strong></p>
<h2 id="å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘"><a href="#å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘" class="headerlink" title="å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘"></a>å‡½æ•°å¼ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘</h2><p>ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶éœ€è¦å®Œå…¨æ‘’å¼ƒæ‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ€ç»´æ¨¡å¼ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼š<strong>React æ ¹æ®å½“å‰çš„ props å’Œ state æ¥ <em>åŒæ­¥</em> DOM</strong>ã€‚</p>
<p>æ‰€ä»¥å¯¹äº<code>useEffect</code>æ¥è¯´ï¼Œå®ƒ<strong>æ ¹æ®å½“å‰çš„ props å’Œ stateï¼ŒåŒæ­¥ React tree ä»¥å¤–çš„å†…å®¹</strong>ã€‚</p>
<p>æ‰€ä»¥åœ¨è¿™ä¸ªæ€ç»´æ¨¡å¼ä¸‹ï¼Œâ€œç»“æœæ¯”è¿‡ç¨‹æ›´ä¸ºé‡è¦â€ã€‚</p>
<h2 id="ä½¿ç”¨ä¾èµ–æ•°ç»„é¿å…ä¸å¿…è¦çš„æ¸²æŸ“"><a href="#ä½¿ç”¨ä¾èµ–æ•°ç»„é¿å…ä¸å¿…è¦çš„æ¸²æŸ“" class="headerlink" title="ä½¿ç”¨ä¾èµ–æ•°ç»„é¿å…ä¸å¿…è¦çš„æ¸²æŸ“"></a>ä½¿ç”¨ä¾èµ–æ•°ç»„é¿å…ä¸å¿…è¦çš„æ¸²æŸ“</h2><p>åŸºæœ¬è§„åˆ™æ˜¯ï¼Œå¦‚æœåœ¨ä¾èµ–æ•°ç»„ä¸­ç”Ÿå‘½äº†å˜é‡ï¼Œä»…åœ¨å˜é‡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œ<code>useEffect</code>æ‰è°ƒç”¨ï¼Œå¦‚æœä¾èµ–æ•°ç»„æ˜¯ç©ºæ•°ç»„çš„è¯ï¼Œä»…åœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™è°ƒç”¨<code>useEffect</code>.</p>
<p>åŸºæœ¬åŸåˆ™æ˜¯ï¼š<strong>ä»»ä½•ç»„ä»¶ä¸­çš„å€¼ï¼Œå¦‚æœä½ åœ¨ useEffect ä¸­ä½¿ç”¨äº†ï¼Œå°±å¿…é¡»å£°æ˜åœ¨ä¾èµ–æ•°ç»„ä¸­ã€‚</strong></p>
<h2 id="å‡å°‘ä¾èµ–æ•°ç»„çš„ä½¿ç”¨"><a href="#å‡å°‘ä¾èµ–æ•°ç»„çš„ä½¿ç”¨" class="headerlink" title="å‡å°‘ä¾èµ–æ•°ç»„çš„ä½¿ç”¨"></a>å‡å°‘ä¾èµ–æ•°ç»„çš„ä½¿ç”¨</h2><ul>
<li>ä½¿ç”¨å‡½æ•°å¼æ›´æ–°</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨è¿™é‡Œï¼ŒuseEffect å¹¶ä¸éœ€è¦<code>count</code>çš„å€¼æ¥æ›´æ–°ï¼Œå› ä¸ºæ¯ä¸€æ¬¡<code>setCount</code>éƒ½å¯ä»¥è‡ªç»™è‡ªè¶³åœ°ç´¯åŠ ï¼Œè€Œæ¯ä¸€æ¬¡<code>count</code>çš„å€¼ä¹Ÿä¼šè‡ªåŠ¨å‘ç”Ÿå˜åŒ–ï¼ŒuseEffect åªç”¨è°ƒç”¨å½“å‰ä¸€æ¬¡ã€‚</p>
<ul>
<li>å°†æ•°æ®æ›´æ–°å’Œæè¿°è¡Œä¸ºåˆ†ç¦»<br>ä¸Šè¿°æ–¹æ³•å¦‚æœåªæœ‰ä¸€ä¸ª state è¿˜å¯ä»¥å®ç°ï¼Œä½†æ˜¯é‡åˆ°ä¸¤ä¸ªåŠä»¥ä¸Š state å°±éš¾ä»¥å®ç°ï¼š</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>step<span class="token punctuation">,</span> setStep<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> c <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>step<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>step<span class="token punctuation">}</span> onChange <span class="token operator">=</span> <span class="token punctuation">{</span> e <span class="token operator">=</span><span class="token operator">></span> <span class="token function">setStep</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»¥ä¸Šçš„å†™æ³•å¯ä»¥æ›¿æ¢æˆï¼š</p>
<pre class="line-numbers language-javascript"><code class="language-javascript">
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>count<span class="token punctuation">,</span> step<span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span> 'tick<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span>


  <span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    step<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>count<span class="token punctuation">,</span> step<span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tick'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> count <span class="token operator">+</span> step<span class="token punctuation">,</span> step<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'step'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>count<span class="token punctuation">,</span> step<span class="token punctuation">:</span> action<span class="token punctuation">.</span>step<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨<code>reducer</code>å¯ä»¥å°†æ•°æ®çš„æ›´æ–°å’Œæ•°æ®è¡Œä¸ºåˆ†ç¦»ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦æŠŠ<code>step</code>ä¼ å…¥ä½œä¸º<code>useEffect</code>çš„ä¾èµ–é¡¹ï¼Œè™½ç„¶æˆ‘ä»¬ä¼ å…¥äº†<code>dispatch</code>,ä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>dispatch</code>çš„å€¼æ˜¯ä¿æŒä¸å˜çš„ã€‚åŒæ—¶åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ useEffect å†…éƒ¨éœ€è¦çš„æ˜¯ä»€ä¹ˆè¡Œä¸ºã€‚</p>
<ul>
<li>å‡½æ•°ä½œä¸ºä¾èµ–é¡¹<br>ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯è®¤ä¸ºå‡½æ•°ä¸å¯ä»¥ä½œä¸ºä¾èµ–é¡¹ï¼Œå…¶å®ä¸ç„¶ã€‚<br>è®¤ä¸ºä¸èƒ½å°†å‡½æ•°ä½œä¸ºä¾èµ–é¡¹æ˜¯å› ä¸ºå£°æ˜åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨çš„å‡½æ•°åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·å˜åŒ–å¾—è¿‡äºé¢‘ç¹ã€‚<br>å¯ä»¥ä½¿ç”¨<code>useCallback</code>æ‰“åŒ…è¿™ä¸ªå‡½æ•°ï¼š</li>
</ul>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> getFetchURL <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://...query ='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchURL</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchURL</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”šè‡³æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´ä¸ºï¼š</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> getFetchURL <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://...query ='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchURL</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://overreacted.io/a-complete-guide-to-useeffect/">A complete Guide to useEffect - Dan Abramov</a></p>

    </div>
  
    <hr>
    
    
       <!-- categories -->
    
       
    <span class="post-categories">
      <i class='icon iconfont icon-icon-goodscategory'></i>
      <a href="/categories/åŸºç¡€çŸ¥è¯†ç›˜ç‚¹/">åŸºç¡€çŸ¥è¯†ç›˜ç‚¹</a>
    </span>
    
    
       <!-- tag -->
     
    
    <span class="post-tags">
      <i class="icon iconfont icon-tag"></i>
      <a href="/tags/react/">react</a>
    </span>
    
  </div>
</div>


</div>
  
  </body>
</html>
